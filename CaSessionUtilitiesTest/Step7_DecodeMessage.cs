using System;
using System.Linq;
using System.Text;
using CaSessionUtilities.Messaging.ZipV2;
using Org.BouncyCastle.Utilities.Encoders;

namespace CaSessionUtilitiesTest;

public class Step7_DecodeMessage
{
    //From V100 Java encoding tests
    public const string Case1_Length10_Message = "504b03041400080808001b5b3c5500000000000000000000000005000000525f315f3133d433d0330000504b070836623b130700000005000000504b03041400080808001b5b3c550000000000000000000000000400000041545f3193bcf45a55f37bcbcc374758f6bcd8d6ff0100504b07080d02358c1300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f335f31cbcb2f490500504b070814fabdcf0600000004000000504b03041400080808001b5b3c550000000000000000000000000400000041545f33bbcff679efdf934a3c718c5cd57c373c760200504b0708a7140dac1300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f325f31ab56ca2c53b252323134b574363332713134353632347275b5343535b3b070b57474323437353657d2512a4a49f5cc4bcb57b2aa562a484e09284dcac94cf64ead046a3630044a27e7e7e626e6a500b97ef9e58a4ab5b500504b0708a6929070580000005a000000504b03041400080808001b5b3c550000000000000000000000000400000041545f325bf2eaab64d494eb3bee27679e0b7cb8ab1a00504b0708d507f1291300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f355f31cb17ebd4e2db33a9ed476067ecd3e8d7dd00504b07082d6a85e31200000010000000504b03041400080808001b5b3c550000000000000000000000000400000041545f352bd2e8d8d534b7e2c6be8e69473d5ff8660200504b0708739772a81300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f345f31012000dfff4d962793282317e7b6b18bde1407a5fe23588adf79900d91890fbe44b48dc1d3504b0708e2a44e162500000020000000504b03041400080808001b5b3c550000000000000000000000000400000041545f347b23a8116853fbfb757bedbb2d0e473b5500504b0708311abd4a1200000010000000504b010214001400080808001b5b3c5536623b130700000005000000050000000000000000000000000000000000525f315f31504b010214001400080808001b5b3c550d02358c130000001000000004000000000000000000000000003a00000041545f31504b010214001400080808001b5b3c5514fabdcf060000000400000005000000000000000000000000007f000000525f335f31504b010214001400080808001b5b3c55a7140dac13000000100000000400000000000000000000000000b800000041545f33504b010214001400080808001b5b3c55a6929070580000005a0000000500000000000000000000000000fd000000525f325f31504b010214001400080808001b5b3c55d507f129130000001000000004000000000000000000000000008801000041545f32504b010214001400080808001b5b3c552d6a85e312000000100000000500000000000000000000000000cd010000525f355f31504b010214001400080808001b5b3c55739772a8130000001000000004000000000000000000000000001202000041545f35504b010214001400080808001b5b3c55e2a44e162500000020000000050000000000000000000000000057020000525f345f31504b010214001400080808001b5b3c55311abd4a12000000100000000400000000000000000000000000af02000041545f34504b0506000000000a000a00f9010000f30200000000";
    public const string Case1_Length100_Message = "504b03041400080808001b5b3c5500000000000000000000000005000000525f315f3133d433d0330000504b070836623b130700000005000000504b03041400080808001b5b3c550000000000000000000000000400000041545f31f37e77338561dab330a6069fe870de7d4600504b0708a9815fa61200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f335f31cbcb2f490500504b070814fabdcf0600000004000000504b03041400080808001b5b3c550000000000000000000000000400000041545f333bfdfbfbe4294e5edbfe316f8b537def7f1100504b0708663d7f871300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f325f31ab56ca2c53b25272717335753237034247132763475337532343230b432757173743474b7317251da5a29454cfbcb47c25ab6aa582e49480d2a49ccc64efd44aa0660343a074727e6e6e625e0a90eb975faea8545b0b00504b0708381c6b4e570000005a000000504b03041400080808001b5b3c550000000000000000000000000400000041545f32130a3d70c7abf5d26aad250f6bb7cefba70d00504b07080d47efdc1300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f355f315bf97ce365fed828772e8598dc1d01bbd70100504b0708a8c5f75f1300000010000000504b03041400080808001b5b3c550000000000000000000000000400000041545f35b3de5a1d51effe6d424d8cf6d50b9257f801504b07087b34d70d1200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f345f3113e73cd919d13581459443c1393a61aa65b691d3aaa593d689dd9313b6de9b1b721300504b0708e133956f2300000020000000504b03041400080808001b5b3c550000000000000000000000000400000041545f348bd4f3d899989b7f96b1fb41f1f13f429100504b07082a3a105c1200000010000000504b010214001400080808001b5b3c5536623b130700000005000000050000000000000000000000000000000000525f315f31504b010214001400080808001b5b3c55a9815fa6120000001000000004000000000000000000000000003a00000041545f31504b010214001400080808001b5b3c5514fabdcf060000000400000005000000000000000000000000007e000000525f335f31504b010214001400080808001b5b3c55663d7f8713000000100000000400000000000000000000000000b700000041545f33504b010214001400080808001b5b3c55381c6b4e570000005a0000000500000000000000000000000000fc000000525f325f31504b010214001400080808001b5b3c550d47efdc130000001000000004000000000000000000000000008601000041545f32504b010214001400080808001b5b3c55a8c5f75f13000000100000000500000000000000000000000000cb010000525f355f31504b010214001400080808001b5b3c557b34d70d120000001000000004000000000000000000000000001102000041545f35504b010214001400080808001b5b3c55e133956f2300000020000000050000000000000000000000000055020000525f345f31504b010214001400080808001b5b3c552a3a105c12000000100000000400000000000000000000000000ab02000041545f34504b0506000000000a000a00f9010000ef0200000000";
    public const string Case2_Length10_Message = "504b03041400080808001b5b3c5500000000000000000000000005000000525f315f3133d433d0330000504b070836623b130700000005000000504b03041400080808001b5b3c550000000000000000000000000400000041545f319bc553bffb42f4b48991fd6c3a46b3799e0300504b070882369ed21300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f335f31cbcb2f490500504b070814fabdcf0600000004000000504b03041400080808001b5b3c550000000000000000000000000400000041545f33d35ec596747ad2fed403151ff777fab67c0100504b0708bbac6fbb1300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f325f31ab56ca2c53b252327631b434343070723477713172b1703404024b0b63432327377333674743251da5a29454cfbcb47c25ab6aa582e49480d2a49ccc64efd44aa066039074727e6e6e625e0a90eb975faea8545b0b00504b0708f2fd47f7560000005a000000504b03041400080808001b5b3c550000000000000000000000000400000041545f32333d6ceab82954e382b9ff84cd3d270a2f0200504b070815bbadec1300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f355f313b6a101fcea2ab1dd06b666f3b2dfac15500504b0708924154591200000010000000504b03041400080808001b5b3c550000000000000000000000000400000041545f355b7f5f3eff6d6eaa77ceb4c96b3425e70b0200504b0708304f0ef51300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f345f319b613f31f2ee042e1e9d6ddbf573dddb4ff2a94ce468587cb7ea8ea5bd6051fbc60000504b07086c49c09d2300000020000000504b03041400080808001b5b3c550000000000000000000000000400000041545f34cbcccdbefbdf656316c7fca0eb073724cd0000504b0708ffbb2f711300000010000000504b010214001400080808001b5b3c5536623b130700000005000000050000000000000000000000000000000000525f315f31504b010214001400080808001b5b3c5582369ed2130000001000000004000000000000000000000000003a00000041545f31504b010214001400080808001b5b3c5514fabdcf060000000400000005000000000000000000000000007f000000525f335f31504b010214001400080808001b5b3c55bbac6fbb13000000100000000400000000000000000000000000b800000041545f33504b010214001400080808001b5b3c55f2fd47f7560000005a0000000500000000000000000000000000fd000000525f325f31504b010214001400080808001b5b3c5515bbadec130000001000000004000000000000000000000000008601000041545f32504b010214001400080808001b5b3c559241545912000000100000000500000000000000000000000000cb010000525f355f31504b010214001400080808001b5b3c55304f0ef5130000001000000004000000000000000000000000001002000041545f35504b010214001400080808001b5b3c556c49c09d2300000020000000050000000000000000000000000055020000525f345f31504b010214001400080808001b5b3c55ffbb2f7113000000100000000400000000000000000000000000ab02000041545f34504b0506000000000a000a00f9010000f00200000000";
    public const string Case2_Length100_Message = "504b03041400080808001b5b3c5500000000000000000000000005000000525f315f3133d433d0330000504b070836623b130700000005000000504b03041400080808001b5b3c550000000000000000000000000400000041545f313b39ebe993535e0b26f1374ef4b74f5ce50200504b0708f3a717371300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f335f31cbcb2f490500504b070814fabdcf0600000004000000504b03041400080808001b5b3c550000000000000000000000000400000041545f33dbc453d7fae0304769f5a512ef6d4a477900504b07083ec59a081200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f325f31ab56ca2c53b25272347671343337323375717434363532313534707574363071b6b0b07034307754d2512a4a49f5cc4bcb57b2aa562a484e09284dcac94cf64ead046a3630044a27e7e7e626e6a500b97ef9e58a4ab5b500504b0708e30ed47f580000005a000000504b03041400080808001b5b3c550000000000000000000000000400000041545f32e376e279f4ba5471dee21c2be719ff456200504b0708be2eee7c1200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f355f317bfda7f9f3739df9f1a1eb45b99b24bc570000504b0708c81b7fbd1300000010000000504b03041400080808001b5b3c550000000000000000000000000400000041545f353b73f5c2c36d8b7be2730b25227ed64f6d0000504b0708718d301c1300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f345f31012000dfff9113b73184368b9de915c298fa96d8adf665ea844755d79b568ee918b92cd7c5504b0708ed6443292500000020000000504b03041400080808001b5b3c550000000000000000000000000400000041545f34eb3fbfffda4a0dde6f0f351756f6f5f04c0600504b07083b3db9431300000010000000504b010214001400080808001b5b3c5536623b130700000005000000050000000000000000000000000000000000525f315f31504b010214001400080808001b5b3c55f3a71737130000001000000004000000000000000000000000003a00000041545f31504b010214001400080808001b5b3c5514fabdcf060000000400000005000000000000000000000000007f000000525f335f31504b010214001400080808001b5b3c553ec59a0812000000100000000400000000000000000000000000b800000041545f33504b010214001400080808001b5b3c55e30ed47f580000005a0000000500000000000000000000000000fc000000525f325f31504b010214001400080808001b5b3c55be2eee7c120000001000000004000000000000000000000000008701000041545f32504b010214001400080808001b5b3c55c81b7fbd13000000100000000500000000000000000000000000cb010000525f355f31504b010214001400080808001b5b3c55718d301c130000001000000004000000000000000000000000001102000041545f35504b010214001400080808001b5b3c55ed6443292500000020000000050000000000000000000000000056020000525f345f31504b010214001400080808001b5b3c553b3db94313000000100000000400000000000000000000000000ae02000041545f34504b0506000000000a000a00f9010000f30200000000";
    public const string Case3_Length10_Message = "504b03041400080808001b5b3c5500000000000000000000000005000000525f315f3133d433d0330000504b070836623b130700000005000000504b03041400080808001b5b3c550000000000000000000000000400000041545f31dbe73131f2de016f5fcd42ce96d907aaf501504b07080ef7679c1200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f335f31cbcb2f490500504b070814fabdcf0600000004000000504b03041400080808001b5b3c550000000000000000000000000400000041545f33fbcccb1ddd6b1e3f41cb7acbea430b6c1d01504b070894fd5f4c1200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f325f31ab56ca2c53b2527274b2b070723533b0307776713677713233b2347775327535717431763334b454d2512a4a49f5cc4bcb57b2aa562a484e09284dcac94cf64ead046a3630044a27e7e7e626e6a500b97ef9e58a4ab5b500504b07084366b51e580000005a000000504b03041400080808001b5b3c550000000000000000000000000400000041545f322bfc28747d97cfe3aaeff6877a638ebef80900504b0708d065a33e1300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f355f317bc0ec2d99b0e645d3b607c7f6705e3b5a0500504b070810dc24e91300000010000000504b03041400080808001b5b3c550000000000000000000000000400000041545f35dbc034bb55e49fa6ce493e5dcb5bfef6ae00504b07088d08d0b31200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f345f31eb6bf8f397e35be35ff9bcbee3ed279e5e2cd2d148df24edb6eee06b9ea419f1a67c00504b0708e10f6d292300000020000000504b03041400080808001b5b3c550000000000000000000000000400000041545f34e367f25fe57a58e195b84089d4a5af1b8d00504b0708513e67251200000010000000504b010214001400080808001b5b3c5536623b130700000005000000050000000000000000000000000000000000525f315f31504b010214001400080808001b5b3c550ef7679c120000001000000004000000000000000000000000003a00000041545f31504b010214001400080808001b5b3c5514fabdcf060000000400000005000000000000000000000000007e000000525f335f31504b010214001400080808001b5b3c5594fd5f4c12000000100000000400000000000000000000000000b700000041545f33504b010214001400080808001b5b3c554366b51e580000005a0000000500000000000000000000000000fb000000525f325f31504b010214001400080808001b5b3c55d065a33e130000001000000004000000000000000000000000008601000041545f32504b010214001400080808001b5b3c5510dc24e913000000100000000500000000000000000000000000cb010000525f355f31504b010214001400080808001b5b3c558d08d0b3120000001000000004000000000000000000000000001102000041545f35504b010214001400080808001b5b3c55e10f6d292300000020000000050000000000000000000000000055020000525f345f31504b010214001400080808001b5b3c55513e672512000000100000000400000000000000000000000000ab02000041545f34504b0506000000000a000a00f9010000ef0200000000";
    public const string Case3_Length100_Message = "504b03041400080808001b5b3c5500000000000000000000000005000000525f315f3133d433d0330000504b070836623b130700000005000000504b03041400080808001b5b3c550000000000000000000000000400000041545f3193fd7462760da7cf7fb723a9d1a2b1da1200504b07087ae09dd01200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f335f31cbcb2f490500504b070814fabdcf0600000004000000504b03041400080808001b5b3c550000000000000000000000000400000041545f33cbf8e967b2f753ddfee986bf3f781d4bff0400504b07089feba5951300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f325f31ab56ca2c53b2523237b670b2747633b134b13472b5307676713134b73433713536357675b1307255d2512a4a49f5cc4bcb57b2aa562a484e09284dcac94cf64ead046a3630044a27e7e7e626e6a500b97ef9e58a4ab5b500504b070813786d25580000005a000000504b03041400080808001b5b3c550000000000000000000000000400000041545f329bf3efce16c123bbf566464fe0569f35ab1200504b07089b8d99131300000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f355f31d3620b781259f79d276dda0f514f51c16200504b07082e61bdd01200000010000000504b03041400080808001b5b3c550000000000000000000000000400000041545f35e35d54f2eaaf186fd0adfc74190e99b98900504b070860141bad1200000010000000504b03041400080808001b5b3c5500000000000000000000000005000000525f345f313bd1dee2a12ec0f73a2c2f9bff1db3fd6133869dc7d967585ac9ddcf495b147da50a00504b070893dcb2432300000020000000504b03041400080808001b5b3c550000000000000000000000000400000041545f34fb669df876d577fe83e13ead7dcb3db73d0300504b0708c15fe9721300000010000000504b010214001400080808001b5b3c5536623b130700000005000000050000000000000000000000000000000000525f315f31504b010214001400080808001b5b3c557ae09dd0120000001000000004000000000000000000000000003a00000041545f31504b010214001400080808001b5b3c5514fabdcf060000000400000005000000000000000000000000007e000000525f335f31504b010214001400080808001b5b3c559feba59513000000100000000400000000000000000000000000b700000041545f33504b010214001400080808001b5b3c5513786d25580000005a0000000500000000000000000000000000fc000000525f325f31504b010214001400080808001b5b3c559b8d9913130000001000000004000000000000000000000000008701000041545f32504b010214001400080808001b5b3c552e61bdd012000000100000000500000000000000000000000000cc010000525f355f31504b010214001400080808001b5b3c5560141bad120000001000000004000000000000000000000000001102000041545f35504b010214001400080808001b5b3c5593dcb2432300000020000000050000000000000000000000000055020000525f345f31504b010214001400080808001b5b3c55c15fe97213000000100000000400000000000000000000000000ab02000041545f34504b0506000000000a000a00f9010000f00200000000";
    [InlineData(Step5_EncryptionKeyFromRbResponse.Case1_Length10_SecretKey,  Case1_Length10_Message)]
    [InlineData(Step5_EncryptionKeyFromRbResponse.Case1_Length100_SecretKey, Case1_Length100_Message)]
    [InlineData(Step5_EncryptionKeyFromRbResponse.Case2_Length10_SecretKey,  Case2_Length10_Message)]
    [InlineData(Step5_EncryptionKeyFromRbResponse.Case2_Length100_SecretKey, Case2_Length100_Message)]
    [InlineData(Step5_EncryptionKeyFromRbResponse.Case3_Length10_SecretKey,  Case3_Length10_Message)]
    [InlineData(Step5_EncryptionKeyFromRbResponse.Case3_Length100_SecretKey, Case3_Length100_Message)]

    //From Java roundtrip tests
    [InlineData("46972FDE1202339A69F9F000F6C9EDC0415D2FF6AB2C78D8376EF0D24A9148D7", "504B0304140008080800AA593C5500000000000000000000000005000000525F315F3133D433D0330000504B070836623B130700000005000000504B0304140008080800AA593C550000000000000000000000000400000041545F319B67785DF9D3990F3DD396DFAEADD291FA0800504B0708FE538C021300000010000000504B0304140008080800AA593C5500000000000000000000000005000000525F335F31CBCB2F490500504B070814FABDCF0600000004000000504B0304140008080800AA593C550000000000000000000000000400000041545F33536ADA5C5CF3E8C2AAF337BE6C127A3A271B00504B0708D5735E341300000010000000504B0304140008080800AA593C5500000000000000000000000005000000525F325F31AB56CA2C53B252727533763130713633B0747236313271343233B230373436B270353337B4303252D2512A4A49F5CC4BCB57B2AA562A484E09284DCAC94CF64EAD046A3630044A27E7E7E626E6A500B97EF9E58A4AB5B500504B07089EFFC5E2580000005A000000504B0304140008080800AA593C550000000000000000000000000400000041545F32D3D7944E0DFF77F5ECCB09A59F383DF6EA0100504B070825D619461300000010000000504B0304140008080800AA593C5500000000000000000000000005000000525F355F319B74FDC8C53FF29B97A55F38D2E57BE17B3C00504B0708597224EF1300000010000000504B0304140008080800AA593C550000000000000000000000000400000041545F35B35FB82F21E17DFDBB086EF7F3DF4EB37E0700504B0708BBBD91F51300000010000000504B0304140008080800AA593C5500000000000000000000000005000000525F345F3193EE0A7F69F3B27F6A4EBA1043A52DEFB693ACC201AA7B8FDABEDB1E7BF39AFC2D7D00504B070821EC8E572300000020000000504B0304140008080800AA593C550000000000000000000000000400000041545F34FBF2737DDD0ABB056F8DC36EF6985DBA6C0200504B0708034562611300000010000000504B01021400140008080800AA593C5536623B130700000005000000050000000000000000000000000000000000525F315F31504B01021400140008080800AA593C55FE538C02130000001000000004000000000000000000000000003A00000041545F31504B01021400140008080800AA593C5514FABDCF060000000400000005000000000000000000000000007F000000525F335F31504B01021400140008080800AA593C55D5735E3413000000100000000400000000000000000000000000B800000041545F33504B01021400140008080800AA593C559EFFC5E2580000005A0000000500000000000000000000000000FD\r\n000000525F325F31504B01021400140008080800AA593C5525D61946130000001000000004000000000000000000000000008801000041545F32504B01021400140008080800AA593C55597224EF13000000100000000500000000000000000000000000CD010000525F355F31504B01021400140008080800AA593C55BBBD91F5130000001000000004000000000000000000000000001302000041545F35504B01021400140008080800AA593C5521EC8E572300000020000000050000000000000000000000000058020000525F345F31504B01021400140008080800AA593C550345626113000000100000000400000000000000000000000000AE02000041545F34504B0506000000000A000A00F9010000F30200000000")]
    [InlineData("314E4F83747F8759BDF15E8E9BDA6955D77DDDDCE958AA57914520DD2DE3FA0B", "504B03041400080808001B5B3C5500000000000000000000000005000000525F315F3133D433D0330000504B070836623B130700000005000000504B03041400080808001B5B3C550000000000000000000000000400000041545F318BD89D69126B1CAAF72069DBA586A4731500504B0708BF70CEE51200000010000000504B03041400080808001B5B3C5500000000000000000000000005000000525F335F31CBCB2F490500504B070814FABDCF0600000004000000504B03041400080808001B5B3C550000000000000000000000000400000041545F336B98F1E1555EDA81B7770FFCEE8DEA3C900900504B0708AEEBD2901300000010000000504B03041400080808001B5B3C5500000000000000000000000005000000525F325F31AB56CA2C53B2527231B270727636733575B4B4703132B770B2747173713537337036B47073733152D2512A4A49F5CC4BCB57B2AA562A484E09284DCAC94CF64EAD046A3630044A27E7E7E626E6A500B97EF9E58A4AB5B500504B0708164201D9580000005A000000504B03041400080808001B5B3C550000000000000000000000000400000041545F32BBD19CF6E4D78A86F013AB92E5BF2777AE0600504B0708CEEDD6871300000010000000504B03041400080808001B5B3C5500000000000000000000000005000000525F355F31B33450A9E86D4FE52A64776A9A7C7FC67200504B0708201FF3CE1200000010000000504B03041400080808001B5B3C550000000000000000000000000400000041545F3553F7748858C6708CADFFEA9CB643C9B9E600504B0708B96A6DE01200000010000000504B03041400080808001B5B3C5500000000000000000000000005000000525F345F316BD25B7BFF71BDE6D27BFC1DAAEEAE4B5399638BEF8B3EBA78CECFAE3758B7ACFC2400504B070838B3CA7E2300000020000000504B03041400080808001B5B3C550000000000000000000000000400000041545F34539549525F107CA7F1B2D6C1FAD0DD07F300504B0708594007811200000010000000504B010214001400080808001B5B3C5536623B130700000005000000050000000000000000000000000000000000525F315F31504B010214001400080808001B5B3C55BF70CEE5120000001000000004000000000000000000000000003A00000041545F31504B010214001400080808001B5B3C5514FABDCF060000000400000005000000000000000000000000007E000000525F335F31504B010214001400080808001B5B3C55AEEBD29013000000100000000400000000000000000000000000B700000041545F33504B010214001400080808001B5B3C55164201D9580000005A0000000500000000000000000000000000FC00000052\r\n5F325F31504B010214001400080808001B5B3C55CEEDD687130000001000000004000000000000000000000000008701000041545F32504B010214001400080808001B5B3C55201FF3CE12000000100000000500000000000000000000000000CC010000525F355F31504B010214001400080808001B5B3C55B96A6DE0120000001000000004000000000000000000000000001102000041545F35504B010214001400080808001B5B3C5538B3CA7E2300000020000000050000000000000000000000000055020000525F345F31504B010214001400080808001B5B3C555940078112000000100000000400000000000000000000000000AB02000041545F34504B0506000000000A000A00F9010000EF0200000000")]
    [Theory]
    public void Decode(string secretKeyHex, string messageHex)
    {
        var secretKey = Hex.Decode(secretKeyHex);
        var decoder = new ZipMessageDecoder();
        var actualRdeSessionArgs = decoder.DecodeRdeSessionArgs(Hex.Decode(messageHex));
        Assert.Equal(16, Hex.Decode(actualRdeSessionArgs.Iv).Length);
        var message = decoder.Decode(secretKey);
        Assert.Equal("note", message.Note);
        Assert.Equal("argle", message.Files[0].Filename);
        Assert.Equal("argle...", Encoding.UTF8.GetString(message.Files[0].Content));
    }
}